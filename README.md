## Second course
# system-calls

**stat** - вносит в структуру, на которую указывает statbuf, информацию, содержащуюся в файле, связанном с указателем filename. Структура stat определена в sys\stat.h. Структура stat определена в sys\stat.h. 
```
int stat (const char *pathname, struct stat *buf);
```

**lstat** - похожа на stat, но возвращает информацию о символической ссылке, а не о файле на который та указывает. 
```
int lstat(const char *pathname, struct stat *buf);
```

**fstat** - идентичен stat(), но опрашиваемый файл задаётся в виде файлового дескриптора fd. 
```
int fstat(int fd, struct stat *buf);
```

**fstatat** -  Если в pathname задан относительный путь, то он считается относительно каталога, на который ссылается файловый дескриптор dirfd.
Если в pathname задан относительный путь и значение dirfd равно AT_FDCWD, то pathname рассматривается относительно текущего рабочего каталога вызывающего процесса (как stat()). 
```
int fstatat(int dirfd, const char *pathname, struct stat *buf, int flags);
```

**statx** - Эта функция возвращает информацию о файле, сохраняя ее в буфер, на который указывает statxbuf. 
```
int statx(int dirfd, const char *pathname, int flags, unsigned int mask, struct statx *statxbuf);
```

**open** - открывает файл по указанному пути, если файла нет он может его создать. 
Фалги: O_RDONLY, O_WRONLY, O_RDWR, O_CREAT, O_TRUNC, O_EXCL
```
int open(const char *pathname, int flags);
int open(const char *pathname, int flags, mode_t mode); 0644
```

**write** - записать в файловый дескриптор, какое-то количество байтов из буффера.
```
ssize_t write(int fd, const void *buf, size_t count);
```

**close** - закрывает файловый дескриптор, так что он больше не ссылается ни на один файл. 
```
int close(int fd);
```

**dprintf** - записывает выходные данные в файловый дескриптор fd. 
```
int dprintf(int fd, const char *format, ...);
```

**read** - читывает count байт из файла, описываемого аргументом fd, в буфер, на который указывает аргумент buf Указателю положения в файле дается приращение на количество считанных байт. Функция возвращает количество действительно считанных байт. Это количество может быть меньше, чем count, если встретился маркер конца файла или если до того, как было считано count байт, произошла ошибка. В случае ошибки возвращается —1, а 0 возвращается при попытке чтения в конце файла. 
```
int read(int fd, void *buf, unsigned count)
```

**pwrite** - записывает максимум count байтов из буфера buf в файловый дескриптор fd , начиная со смещения offset. Текущая позиция файла не изменяется. 
```
ssize_t pwrite(int fd, const void *buf, size_t count, off_t offset); 
```

**pread** - читает максимум count байтов из файлового дескриптора fd, начиная со смещения offset (от начала файла), в буфер, начиная с buf. Текущая позиция файла не изменяется. 
```
ssize_t pread(int fd, void *buf, size_t count, off_t offset); 
```

**fchmod** - изменяет права доступа к файлу, на который указывает открытый файловый дескриптор fd. 
```
int fchmod(int fd, mode_t mode);
```

**futimens** - обновляет временные метки файла с наносекундной точностью. Файл указывается в виде открытого файлового дескриптора в fd. 
```
int futimens(int fd, const struct timespec times[2]);
```

**chown** - Изменяет владельца для файла, задаваемого параметрами path. Только суперпользователь может изменять владельца файла. Владелец файла может изменять группу файла на любую группу, к которой он принадлежит. Суперпользователь может произвольно изменять группу. 
```
int chown(const char *path, uid_t owner, gid_t group);
```

**fchown** - То же самопе что и chown, но файл задается в fd.
```
int fchown(int fd, uid_t owner, gid_t group);
```

**opendir** - открывает поток каталога, соответствующий каталогу name, и возвращает указатель на этот поток. Поток устанавливается на первой записи в каталоге.
```
DIR *opendir(const char *name);
```

**readdir** - возвращает указатель на следующую запись каталога в структуре dirent, прочитанную из потока каталога. Каталог указан в dir. Функция возвращает NULL по достижении последней записи или если была обнаружена ошибка. Библиотека dirent.h и sys/types.h
```
struct dirent *readdir(DIR *dir);
```

**chdir** - изменяет текущий каталог каталог на path. Библиотека unistd.h
```
int chdir(const char *path);
```

**fchdir** - идентично chdir, только каталог задан в виде открытого файлового дескриптора. Библиотека unistd.h
```
int fchdir(int fd);
```

**dirfd** - возвращает файловый дескриптор, связанный с потоком каталога dirp. Этот файловый дескриптор используется внутри функции потоком каталога. В результате он полезен только для функций, которые не зависят и не изменяют положение в файле, например fstat(2) и fchdir(2). Он автоматически закрывается при вызове closedir(3). 
```
int dirfd(DIR *dirp); 
```

**getdents64** -  читает несколько структур linux_dirent из каталога, на который указывает открытый файловый дескриптор fd, в буфер, указанный в dirp. В аргументе count задаётся размер этого буфера. При нормальном завершении работы возвращается количество прочитанных байт. При достижении конца каталога возвращается 0. 
```
int getdents64(unsigned int fd, struct linux_dirent64 *dirp, unsigned int count);
syscall(SYS_getdents64, fdd, buf, BUF_SIZE); //Использовать так

struct linux_dirent64 {
    ino64_t(long)        d_ino;    /* 64-битный номер иноды */
    off64_t(off_t)        d_off;    /* 64-битное смещение следующей структуры */
    unsigned short d_reclen; /* размер этой dirent */
    unsigned char  d_type;   /* тип файла */
    char           d_name[]; /* имя файла (в конце null) */
}
```

**mkdirat** - пытается создать каталог с именем pathname. Если в pathname задан относительный путь, то он считается относительно каталога, на который ссылается файловый дескриптор dirfd.
```
int mkdirat(int dirfd, const char *pathname, mode_t mode);
```

**statvfs** - возвращает информацию о смонтированной файловой системе. path является путём любого файла, расположенного в смонтированной файловой системе. buf является указателем на структуру statvfs.
```
int statvfs(const char *path, struct statvfs *buf);
```

**statfs** - возвращает информацию о запущенной файловой системе. path - путь к любому файлу, который находится в запущенной файловой системе. buf - указатель на структуру statfs.
```
int statfs(const char *path, struct statfs *buf);
````
 


